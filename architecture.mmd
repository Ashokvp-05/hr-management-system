flowchart TD
    %% -------------------------------------
    %% GLOBAL STYLES
    %% -------------------------------------
    classDef frontend fill:#eef2ff,stroke:#4f46e5,stroke-width:2px,color:#000
    classDef backend fill:#f0fdf4,stroke:#16a34a,stroke-width:2px,color:#000
    classDef data fill:#fff7ed,stroke:#ea580c,stroke-width:2px,color:#000
    classDef realTime fill:#fefce8,stroke:#ca8a04,stroke-width:2px,stroke-dasharray: 5 5,color:#000

    %% -------------------------------------
    %% 1. USER & LOGIN FLOW
    %% -------------------------------------
    User((ðŸ‘¤ User)) --> |1. Opens App| LoginUI[ðŸ” Login Page]
    LoginUI --> |2. Submit Credentials| APIGateway[ðŸšª API Gateway]
    
    subgraph Backend_Logic [Backend System]
        direction TB
        APIGateway --> Auth{ðŸ›¡ï¸ Auth Check}
        Auth -- Invalid --> Error[âŒ Return 401]
        Auth -- Valid --> JWT[ðŸ”‘ Generate JWT]
        JWT --> |Return Token| Dashboard[ðŸ–¥ï¸ User Dashboard]
    end

    %% -------------------------------------
    %% 2. DATA FETCHING (OPTIMIZED)
    %% -------------------------------------
    Dashboard --> |3. Fetch Stats| CacheCheck{âš¡ Check Redis?}
    
    subgraph Data_Layer [Data & Storage]
        direction TB
        CacheCheck -- Hit --> CachedData[(ðŸ“¦ Redis Cache)]
        CacheCheck -- Miss --> QueryDB[ðŸ” Query Database]
        QueryDB --> PrimaryDB[(ðŸ—„ï¸ Primary DB)]
        PrimaryDB --> |Sync| Replica[(ðŸ—„ï¸ Read Replica)]
        PrimaryDB --> |Updates| CachedData
    end

    CachedData --> |Return Data| APIGateway
    PrimaryDB --> |Return Data| APIGateway
    APIGateway --> |JSON Response| Dashboard

    %% -------------------------------------
    %% 3. REAL-TIME INTERACTION (SOCKETS)
    %% -------------------------------------
    subgraph RealTime_Layer [Real-Time Sync]
        SocketServer[ðŸ“¡ WebSocket Server]
    end

    Dashboard -.-> |4. Connect (Socket.io)| SocketServer
    
    %% Scenario: Leave Request
    Dashboard --> |5. Apply Leave| LeaveAPI[ðŸ“ Leave Service]
    LeaveAPI --> |Write| PrimaryDB
    LeaveAPI --> |Trigger Event| SocketServer
    SocketServer -.-> |6. Push Notification| ManagerDash[ðŸ‘¤ Manager Dashboard]
    
    ManagerDash --> |7. Approve| LeaveAPI
    LeaveAPI --> |Update Status| PrimaryDB
    LeaveAPI --> |Trigger Event| SocketServer
    SocketServer -.-> |8. Instant Update| Dashboard

    %% -------------------------------------
    %% CLASS ASSIGNMENT
    %% -------------------------------------
    class LoginUI,Dashboard,ManagerDash frontend
    class APIGateway,Auth,JWT,LeaveAPI backend
    class PrimaryDB,Replica,CachedData data
    class SocketServer realTime
